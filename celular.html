<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cabine de Fotos - Celular</title>
  <style>
    body { background:#111; color:white; font-family:Arial; text-align:center; }
    input[type="file"] { margin:20px; }
    img { max-width:150px; margin:10px; border-radius:8px; }
    button { padding:10px 20px; margin:10px; font-size:16px; cursor:pointer; }
  </style>
</head>
<body>
  <h1>Envio de Fotos</h1>
  <input type="file" id="photoInput" accept="image/*" multiple>
  <div id="preview"></div>
  <button onclick="sendPhotos()">Enviar Fotos</button>

  <script src="/assets/socket.io.js"></script>
  <script>
    const socket = io();
    const urlParams = new URLSearchParams(window.location.search);
    const sessionId = urlParams.get('session'); // pega da URL
    const preview = document.getElementById('preview');
    let photosToSend = [];

    document.getElementById('photoInput').addEventListener('change', (e) => {
      preview.innerHTML = "";
      photosToSend = [];
      Array.from(e.target.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = (ev) => {
          const img = document.createElement('img');
          img.src = ev.target.result;
          preview.appendChild(img);
          photosToSend.push(ev.target.result);
        };
        reader.readAsDataURL(file);
      });
    });

    function sendPhotos() {
      if (!photosToSend.length) { alert("Nenhuma foto selecionada"); return; }
      photosToSend.forEach(photo => {
        socket.emit("final_photo", { sessionId, photo });
      });
      alert("Fotos enviadas!");
      preview.innerHTML = "";
      photosToSend = [];
      document.getElementById('photoInput').value = "";
    }
  </script>
</body>
</html>
