<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Photobooth — PC</title>
<style>
  body { font-family: Arial, sans-serif; margin: 16px; background:#111; color:#fff; }
  #gallery { display: flex; flex-wrap: wrap; margin-top: 12px; }
  #gallery .photo-wrapper { position: relative; margin: 6px; }
  #gallery img { height: 120px; cursor: pointer; border-radius: 4px; }
  #gallery button.remove { position: absolute; top: 0; right: 0; background: rgba(0,0,0,0.6); color: #fff; border: none; cursor: pointer; }
  #fullscreenView { position: fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.9); display:none; align-items:center; justify-content:center; }
  #fullscreenView img { max-width:90%; max-height:90%; }
  #fullscreenView button { position:absolute; top:20px; right:20px; font-size:24px; background:#fff; border:none; cursor:pointer; }
</style>
</head>
<body>
<h1>Photobooth — PC</h1>
<div>Session: <span id="session">—</span></div>
<div id="status">Aguardando fotos...</div>
<div style="margin-top:10px">
  <button id="generateControlUrl">Gerar link/QR do controle</button>
  <button id="generateViewerLink">Gerar visualizador</button>
  <button id="resetBtn">Reiniciar sessão</button>
</div>
<div id="gallery"></div>

<div id="fullscreenView">
  <button onclick="closeFullscreen()">✖</button>
  <img id="fullscreenImg"/>
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
const DEFAULT_SOCKET_SERVER="https://render-9ea7.onrender.com";
const session='pc_'+Date.now();
document.getElementById("session").innerText=session;
let socket=io(DEFAULT_SOCKET_SERVER,{transports:["websocket"]});

socket.on("connect",()=>{
  socket.emit("join",{session});
  document.getElementById("status").innerText="Conectado — aguardando fotos...";
});

socket.on("photo",(msg)=>{
  if(msg.session && msg.dataURL){
    addPhoto(msg.dataURL);
  }
});

function addPhoto(dataURL){
  const wrapper=document.createElement("div");
  wrapper.className="photo-wrapper";
  const img=document.createElement("img");
  img.src=dataURL;
  img.onclick=()=>openFullscreen(dataURL);
  wrapper.appendChild(img);
  document.getElementById("gallery").appendChild(wrapper);
}

function openFullscreen(url){
  document.getElementById("fullscreenImg").src=url;
  document.getElementById("fullscreenView").style.display="flex";
}
function closeFullscreen(){
  document.getElementById("fullscreenView").style.display="none";
}

document.getElementById("generateControlUrl").onclick=()=>{
  const url=location.origin+"/celular.html?session="+session+"&socket="+DEFAULT_SOCKET_SERVER;
  showQR(url);
};
document.getElementById("generateViewerLink").onclick=()=>{
  const url=location.origin+"/visualizador.html?session="+session+"&socket="+DEFAULT_SOCKET_SERVER;
  showQR(url);
};
document.getElementById("resetBtn").onclick=()=>{
  location.reload();
};

function showQR(url){
  const w=window.open("","_blank","width=400,height=400");
  w.document.write("<h3>Escaneie o QR Code:</h3><div id='qrcode'></div><p>"+url+"</p>");
  w.document.close();
  new QRCode(w.document.getElementById("qrcode"),url);
}
</script>
</body>
</html>
